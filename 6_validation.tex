\section{Validation}
\jun{section title -> Results?}

We evaluate the proposed framework and the various beading schemes on a set of different types of 3D models, ranging over various applications and various types of geometry. 
The data set is described in Appendix~\ref{dataset}.
We sliced all models in the data set and selected 300 random slices for analysis.
Toolpaths of these 300 outline shapes are generated using the uniform technique as implemented by Clipper~\cite{johnson2014clipper} -- a state-of-the-art polygon offset library, and by our framework using four beading schemes, i.e. the constant bead count scheme with a bead count of $C=4$, the centered, the evenly distributed, and the inward distributed beading scheme, all with a nominal bead widths of $w^*] = \SI{0.4}{\milli\meter}$. The tests were performed on a desktop PC equipped with an Intel Core i7-7500U CPU @ \SI{2.70}{\giga\hertz} (a single core is used) and \SI{16.3}{\giga\byte} memory.





\subsection{Computational results}


\subsubsection{Accuracy}
We first evaluate the accuracy of different beading schemes in terms of the amount of the overfill and underfill. 
This is compared on a slice of a \jun{?} model, as shown in \cref{visualized_accuracy} (top).
\jun{discuss this figure a bit}

We further quantitatively compare the accuracy of the beading schemes on the data set. 
The overfill and underfill areas as a percentage of the total area of the slices from the data set are illustrated in \cref{over_underfill}.  
The inward distributed scheme has a calculated overfill of 0.24\% and an underfill of 0.17\%.
This is lower compared to the uniform scheme, which results in 1.2\% overfill and 1.7\% underfill when applied to the data set.

In order to estimate the overfill and underfill, we need to accurately calculate the area covered by a single extrusion path.
If we would simply use an isosceles trapezoidal area with base lengths equal to the widths of the two end points of the extrusion segment, we would get artifacts at corners in the toolpath (\cref{segment_visualization}a).
We therefore use a semi-circle (\cref{segment_visualization}b) with a diameter equal to the starting width in the one end of each segment, and exclude it at the other end, because it will be included in the next segment.
For polyline extrusion paths which are not closed, we also include the semi-circle corresponding to the extrusion width of the end-position ( \cref{segment_visualization}c).

%In order to print such extrusion paths accurately, we can modulate the amount of material flow per millimeter based on this visualization model.
%See \cref{segment_visualization}.

\begin{figure}
\centering
\setlength{\figwidth}{.25\columnwidth}
\begin{subfigure}{\figwidth}\centering
\includegraphics[width=\columnwidth]{sources/validation/visualization_principle_blocky.pdf}
\caption{Blocky}
\end{subfigure}
\begin{subfigure}{\figwidth}\centering
\includegraphics[width=\columnwidth]{sources/validation/visualization_principle_rounded.pdf}
\caption{Rounded}
\end{subfigure}
\begin{subfigure}{\figwidth}\centering
\includegraphics[width=\columnwidth]{sources/validation/visualization_principle_rounded_excluded.pdf}
\caption{Excluded}
\end{subfigure}
\caption{
Extruded area of two extrusion extrusion segments.
Red areas signify doubly extruded areas.
}
\label{segment_visualization}
\end{figure}

We can then estimate the amount of underfill by unioning the rounded visualization of all extrusion segments and then taking the difference from the original outline shape.
In order to deal with rounding errors, we perform a morphological close of \SI{5}{\micro\meter} before calculating the total area of the underfill regions.

The overfill regions are calculated by adding the polygonal areas of each extrusion segment to a list.
We then add the original outline shape in reverse and perform a Vatti clipping operation~\cite{Vatti2019clipping} which only keeps areas of positive winding number.
Because the reverse outline shape reduces the winding number of all extruded segments by one, only the overfill areas are left with a positive winding number.
In order to estimate the areas which are triply covered by extrusion segments, we repeat the process of adding the outline in reverse and performing Vatti's clipping operation.
These triple extrusion areas count double toward the total amount of overfill.
The resulting overfill and underfill areas are visualized for the different toolpath schemes in the top of \cref{visualized_accuracy}.


\begin{figure*}
\centering
\setlength{\figwidth}{0.19\textwidth}
\setlength{\figheight}{0.283\textwidth}
\begin{subfigure}{\figwidth}\centering
\includegraphics[height=\figheight]{sources/validation/gMAT_example/TEST_naive_accuracy.png}
\includegraphics[height=\figheight]{sources/validation/gMAT_example/TEST_naive_widths.png}
\caption{Uniform}\label{TEST_naive_accuracy}
\end{subfigure}
%\begin{subfigure}{\figwidth}\centering
%\includegraphics[height=\figheight]{sources/validation/gMAT_example/TEST_SingleBead_accuracy.png}
%\includegraphics[height=\figheight]{sources/validation/gMAT_example/TEST_SingleBead_widths.png}
%\caption{Single}\label{TEST_SingleBead_accuracy}
%\end{subfigure}
\begin{subfigure}{\figwidth}\centering
\includegraphics[height=\figheight]{sources/validation/gMAT_example/TEST_Constant_accuracy.png}
\includegraphics[height=\figheight]{sources/validation/gMAT_example/TEST_Constant_widths.png}
\caption{Constant}\label{TEST_Constant_accuracy}
\end{subfigure}
\begin{subfigure}{\figwidth}\centering
\includegraphics[height=\figheight]{sources/validation/gMAT_example/TEST_Center_accuracy.png}
\includegraphics[height=\figheight]{sources/validation/gMAT_example/TEST_Center_widths.png}
\caption{Centered}\label{TEST_Center_accuracy}
\end{subfigure}
\begin{subfigure}{\figwidth}\centering
\includegraphics[height=\figheight]{sources/validation/gMAT_example/TEST_Distributed_accuracy.png}
\includegraphics[height=\figheight]{sources/validation/gMAT_example/TEST_Distributed_widths.png}
\caption{Distributed}\label{TEST_Distributed_accuracy}
\end{subfigure}
\begin{subfigure}{\figwidth}\centering
\includegraphics[width=\columnwidth]{sources/validation/gMAT_example/TEST_InwardDistributed_accuracy.png}
\includegraphics[width=\columnwidth]{sources/validation/gMAT_example/TEST_InwardDistributed_widths.png}
\caption{Inward}\label{TEST_InwardDistributed_accuracy}
\end{subfigure}
\begin{subfigure}{.04\columnwidth}\centering
\vspace{4.7cm}
\includegraphics[height=\figheight]{sources/validation/gMAT_example/widths_legend.pdf}
\end{subfigure}
\caption{
Visualizing the overfills and underfills and the widths for various beading schemes.
Extrusion beads in gray tones,
overfill in orange,
underfill in azure,
narrow beads in blue
and wide beads in red.
}
\label{visualized_accuracy}
\end{figure*}




\begin{figure*}
\centering
\setlength{\figheight}{0.22\textwidth}
\setlength{\figwidth}{0.31\textwidth}
\begin{subfigure}{\figwidth}\centering
\includegraphics[height=\figheight]{sources/validation/computime2.pdf}
%\includegraphics[width=\figwidth]{sources/validation/computime2.pdf}
\caption{Computation time}
\label{computime}
\end{subfigure}
\begin{subfigure}{\figwidth}\centering
\includegraphics[height=\figheight]{sources/validation/widthHistogram.pdf}
%\includegraphics[width=\figwidth]{sources/validation/widthHistogram.pdf}
\caption{Extrusion widths}
\label{widthHistogram}
\end{subfigure}
\begin{subfigure}{\figwidth}\centering
\includegraphics[height=\figheight]{sources/validation/indexedwidths2.pdf}
%\includegraphics[width=\figwidth]{sources/validation/widthHistogram.pdf}
\caption{Extrusion width per index}
\label{widthIndexedHistogram}
\end{subfigure}
\begin{subfigure}{\figwidth}\centering
\includegraphics[height=\figheight]{sources/validation/overunderfill.pdf}
%\includegraphics[width=\figwidth]{sources/validation/overunderfill.pdf}
\caption{Over- and underfill}
\label{over_underfill}
\end{subfigure}
\begin{subfigure}{\figwidth}\centering
\includegraphics[height=\figheight]{sources/validation/smoothness.pdf}
%\includegraphics[width=\figwidth]{sources/validation/smoothness.pdf}
\caption{Site angles}
\label{smoothness}
\end{subfigure}
\begin{subfigure}{\figwidth}\centering
\includegraphics[height=\figheight]{sources/validation/smoothnessNoTransition.pdf}
%\includegraphics[width=\figwidth]{sources/validation/smoothnessNoTransition.pdf}
\caption{Site angles without smoothing}
\label{smoothnessNoTransition}
\end{subfigure}


\caption{
Results of computational analysis of the results from applying the uniform width technique and various beading schemes using our framework to the data set.
Note the use of a logarithmic scale on the Y-axes and on some of the X-axes as well.
}
\end{figure*}









\subsubsection{Uniformity}
Depending on the printer hardware configuration, some bead widths might be difficult or impossible to produce.
A bead width far below the nozzle size can result in fluttered extrusion, while a bead width far above the nozzle size can require pressures above the specifications of the machine. 
Also, large bead widths may cause the extruded material to bulge upwards instead of filling the required width.
Moreover, bead widths deviating from the nominal bead width by a large amount may impact the mechanical properties of the print.
We visualize the bead widths resulting from the different schemes in the bottom of \cref{visualized_accuracy}.

To evaluate the width uniformity, we sampled the extrusion widths of all generated toolpaths 
at intervals of \SI{1}{\micro\meter} along the toolpath.
From these sampled values, we calculated the mean bead width, and standard deviation per scheme.
\cref{widthHistogram} shows the distribution of extrusion width for each scheme binned at intervals of \SI{10}{\micro\meter}.
We found that the mean width of the inward distributed and evenly distributed schemes is close to nominal nozzle size of \SI{400}{\micro\meter}, while their standard deviation is lower than for the centered and constant bead count scheme. 
These results indicate that, while causing less overfill and underfill, inwards distributed and evenly distributed schemes deviate less and infrequently from the nominal bead width compared to the other schemes.
We compared the width uniformity of the 6 outer beads for the inward and evenly distributed schemes, the distribution of these extrusion widths is shown in \cref{widthIndexedHistogram}. 
The outer beads of the inward distributed scheme clearly have more often the nominal width of \SI{400}{\micro\meter}, while the evenly distributed scheme more often extrudes widths that deviate from the nominal width.

\subsubsection{Smoothness of toolpaths}
In order to maintain a high printing speed, it is desirable that toolpaths have fewer and less sharp corners. 
We measured the angle between consecutive extrusion segments generated by each scheme.
The relative frequency of these angles is shown in \cref{smoothness}.
All schemes show a higher number of corners for smaller angles with a peak towards \SI{0}{\degree} (straight line).
The inward distributed scheme produces an order of magnitude less corners around \SI{30}{\degree}, compared to evenly distributed. 
We also investigated the effect of the transition regions on the smoothness of the toolpaths. 
\cref{smoothnessNoTransition} shows that introducing the transitions greatly reduces the number of corners around \SI{90}{\degree}. 

\subsubsection{Computational performance}
\cref{computime} plots the computation time for each of the 300 slices against the vertex count of the layer, comparing the uniform technique~\cite{johnson2014clipper} and our framework with the inward distributed scheme. For polygonal shapes with as many as $10^4$ vertices, the computation for both approaches is less than 1 second, with our method being approximately five times that of the uniform technique.

The algorithmic complexity is limited by the generation of the Voronoi Diagram, which is $O(n \log n)$, where $n$ is the number of vertices in the input shape.
The other steps in our framework have a complexity of $O(n)$ or $O(m)$, where $m$ is the number of elements in the ST.
Therefore, the total running time of our algorithm is $O(n \log n)$. Results in \cref{computime} conform that both our framework and the uniform technique have an expected running time of approximately $5 \times 10^{-6} n \log n$ seconds.
% The computation time of our framework is approximately five times that of the uniform technique, which puts it in the same order of magnitude.

% only Moessen reports on computation times, but in a weird manner

\subsection{Printing results}
Test prints were performed on a custom FDM hardware setup, with a standard \SI{0.4}{\milli\meter} nozzle and a filament extrusion drive directly mounted on the print head.
The firmware of the printer employs linear advance: to gain the extra pressure required to change to a wider bead an extra amount of filament is advanced into the physical system between the filament feeder and the nozzle so that we can realize accurate adaptive deposition width control~\cite{tronvoll2019investigating}. \jun{sentence too long}
We set the preferred width to $w^* = \SI{0.6}{\milli\meter}$, to avoid fluttered printing of lines thinner than the nozzle size.
We used a layer thickness of \SI{0.2}{\milli\meter} and a movement speed of \SI{10}{\milli\meter\per\second}.

The prints are shown in \cref{wedge_print} and \cref{prints}.
Because of inaccuracies in the deposition control system some of the prints show defects.
Such defects are less prevalent for the inward distributed beading scheme than the other schemes.
\jun{discuss the positive aspects of the new beading by 2~3 sentences}

\begin{figure}
\centering
\begin{subfigure}{\columnwidth}\centering
\setlength{\figwidth}{\columnwidth}
\includegraphics[width=\figwidth]{sources/applications/P3_print_wedge_naive_edited.png}
\includegraphics[width=\figwidth]{sources/applications/P3_print_wedge_center_edited.png}
\includegraphics[width=\figwidth]{sources/applications/P3_print_wedge_inward_edited.png}
\caption{Wedge}\label{print_wedge}
\end{subfigure}
\caption{
A wedge shape printed using the uniform scheme, centered scheme and the inward distributed scheme.
The uniform and centered scheme show problems around certain model diameters.
}
\label{wedge_print}
\end{figure}

\begin{figure}
\centering
\setlength{\figheight}{.38\columnwidth}
\setlength{\figheightTwo}{.47\columnwidth}
\setlength{\figwidth}{0.32\columnwidth}
\begin{subfigure}{\figwidth}\centering
%\includegraphics[height=\figheightTwo]{sources/applications/gMAT_naive.png}
\includegraphics[height=\figheight]{sources/applications/P3_print_hex_naive_edited.png}
\includegraphics[width=\figwidth]{sources/applications/P3_print_UM_naive_edited.png}
\caption{Uniform}\label{print_naive}
\end{subfigure}
\begin{subfigure}{\figwidth}\centering
%\includegraphics[height=\figheightTwo]{sources/applications/gMAT_center.png}
\includegraphics[height=\figheight]{sources/applications/P3_print_hex_center_edited.png}
\includegraphics[width=\figwidth]{sources/applications/P3_print_UM_center_edited.png}
\caption{Centered}\label{print_center}
\end{subfigure}
\begin{subfigure}{\figwidth}\centering
%\includegraphics[height=\figheightTwo]{sources/applications/gMAT_inward.png}
\includegraphics[height=\figheight]{sources/applications/P3_print_hex_inward_edited.png}
\includegraphics[width=\figwidth]{sources/applications/P3_print_UM_inward_edited.png}
\caption{Inward distributed}\label{print_inward}
\end{subfigure}
\caption{
Test shapes printed using the uniform scheme, centered scheme and the inward distributed scheme.
The uniform technique produces distinct underfill areas.
The centered scheme shows some defects due to inaccurate control of extremal deposition widths.
The inward distributed scheme produces the least defects.
}
\label{prints}
\end{figure}


\iffalse
\todo{Maybe test the following qualities:}
\begin{itemize}
\item visual consistency of flat top skin surface
\item graphs of tensile tests on thin walled object
\end{itemize}
\fi










%We therefore visualize include a semi-circle with a diameter equal to the starting width in the one end, and exclude it at the other end, because it will be included in the next extrusion segment.


